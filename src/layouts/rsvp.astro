---
const current_url = Astro.url.pathname;
import Animation from "./animation.astro";
---
<form method="post" id="formRsvp"  class="fade-left w-full max-w-xl p-12 mx-auto mb-10 bg-white rounded-md shadow-md border">
  <div class="mt-4 space-y-8 [&>*]:font-poppins [&>*]:text-left [&>*]:text-gray-800/50 [&>*]:space-y-2">
      <div>
          <label for="username">Nama</label>
          <input value="" id="username" type="text" name="name" class="block w-full px-4 py-4 text-gray-700 bg-white border border-gray-200 rounded-md focus:outline-none">
      </div>
      <div>
        <label for="message">Ucapan</label>
        <textarea id="message" rows="4" name="content" class="block p-5 w-full text-sm text-gray-800 bg-gray-50 rounded-lg border border-gray-300 focus:outline-none" placeholder="Selamat untuk acaranya..."></textarea>
      </div>
      <div>
      <div class="flex items-center mb-4 font-poppins">
        <input checked id="default-radio-1" name="present" type="radio" value="1" name="default-radio" class="radio w-4 h-4 accent-gray-600">
        <label for="default-radio-1" class="ms-2 text-base font-medium text-gray-600">Hadir</label>
      </div>
      <div class="flex items-center font-poppins">
        <input id="default-radio-2" name="present" type="radio" value="0" name="default-radio" class="radio w-4 h-4 accent-gray-600">
        <label for="default-radio-2" class="ms-2 text-base font-medium text-gray-600">Tidak Hadir</label>
      </div>
      </div>
  </div>

  <div class="flex justify-end mt-6">
    <button id="send" type="submit" class="px-6 py-2 z-50 relative bg-gray-800 rounded-full text-white font-bold font-poppins flex gap-1 transition-all duration-700 ease-linear hover:bg-white hover:text-gray-800 hover:ring-2 hover:ring-gray-500">Kirim Pesan</button>

  </div>
</form>

  
<div x-data="{ data: [] }" x-init={`fetch('/api/rsvp-get?url=${current_url}').then(response => response.json()).then(rsvp => data = rsvp)`}  class="fade-right flex-none w-full max-w-xl mx-auto overflow-auto bg-white max-h-96 space-y-6 p-6">
  <template x-for="user in data" :key="user.id">
    <div class="flex flex-col leading-1.5 p-8 w-full border-gray-200 bg-gray-100 rounded-e-xl rounded-es-xl font-poppins order-first" id="display">
      <div class="flex items-center justify-between">
        <p x-text="user.name" class="text-md font-semibold text-gray-800 capitalize"></p>
        <p x-text="user.present ? 'Hadir' : 'Tidak Hadir'"
        x-bind:class="{'text-white bg-green-500': user.present, 'text-gray-800 bg-red-500': !user.present}"
        class="text-sm font-normal px-3 py-1 rounded-full"></p>
      </div>
      <p x-text="user.content" class="text-base italic text-left py-5 text-gray-800/50 font-medium"></p>
    </div>
  </template>
</div>

<Animation />
<!-- <div id="result" class="mt-12 flex-none w-full max-w-xl mx-auto overflow-auto bg-white max-h-96 space-y-6 p-6">

</div> -->
<script define:vars={{ current_url }}>
  const formRsvp = document.querySelector("#formRsvp");

 formRsvp.addEventListener("submit", (e) => {
  e.preventDefault();


  const username = document.getElementById("username");
  const message = document.getElementById("message");

  const radio = Array.from(document.getElementsByClassName("radio"));
  let present;
  radio.forEach(function(elm, i){
    if(elm.checked){
      present = elm;
    }
  });

  //const present = document.querySelector(".radio:checked");

  // console.log(username.value);
  // console.log(message.value);
  // console.log(present.value);


  fetch('/api/rsvp-send?name='+username.value+'&content='+message.value+'&present='+present.value+'&url='+current_url+'', {
  method: "GET"
}).then(x => x.text())
.then(y => {

  console.log('selesai');
});


});

// const result = document.getElementById("result");

// fetch('/api/rsvp-get?url=' + encodeURIComponent(current_url), {
//   method: "GET"
// })
// .then(response => response.json())
// .then(data => {
//   const itemsHtml = data.map(item => {
//     return `
//     <div class="flex flex-col leading-1.5 p-8 w-full border-gray-200 bg-gray-100 rounded-e-xl rounded-es-xl font-poppins">
//           <div class="flex items-center justify-between">
//             <p class="text-md font-semibold text-gray-800 capitalize">${item.name}</p>
//             <p class="text-sm font-normal ${item.present ? 'text-white bg-green-500' : 'text-gray-800 bg-red-500'} px-3 py-1 rounded-full">${item.present ? 'Hadir' : 'Tidak Hadir'}</p>
//           </div>
//           <p class="text-base italic text-left py-5 text-gray-800/50 font-medium">${item.content}</p>
//         </div>
//     `;
//   }).join('');

//   result.innerHTML = itemsHtml;
// })
// .catch(error => {
//   console.error('Error fetching data:', error);
//   result.innerHTML = '<p>Terjadi kesalahan saat memuat data.</p>';
// });


</script>
